<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Umsatz - Vetmates</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="../../styles/reset.css">
    <link rel="stylesheet" href="../../styles/variables.css">
    <link rel="stylesheet" href="../../styles/theme.css">
    <link rel="stylesheet" href="../../styles/typography.css">
    <link rel="stylesheet" href="../../styles/utilities.css">
    <link rel="stylesheet" href="../../styles/layout.css">
    <link rel="stylesheet" href="../../styles/components/navbar.css">
    <link rel="stylesheet" href="../../styles/components/sidebar.css">
    <link rel="stylesheet" href="../../styles/components/cards.css">
    <link rel="stylesheet" href="../../styles/components/buttons.css">
    <link rel="stylesheet" href="../../styles/components/tables.css">
    <link rel="stylesheet" href="../../styles/components/forms.css">
    <link rel="stylesheet" href="../../styles/pages/umsatz.css">
</head>
<body>
    <!-- Include Navbar -->
    <div id="navbar-container"></div>
    
    <!-- Include Sidebar -->
    <div id="sidebar-container"></div>
    
    <!-- Main Content -->
    <main class="main-content">
        <div class="umsatz-container">
            <!-- Page Header -->
            <div class="page-header">
                <div class="header-content">
                    <div class="header-left">
                        <a href="../finanzen.html" class="back-button">
                            <span class="back-arrow">←</span>
                            Zurück zu Finanzen
                        </a>
                        <h1 class="page-title">Umsatz</h1>
                        <p class="page-description">Verwalten Sie Ihre Einnahmen aus Behandlungen und Dienstleistungen</p>
                    </div>
                    <div class="header-right">
                        <button class="btn btn-primary btn-new-revenue" id="newRevenueBtn">
                            <span class="btn-icon-wrapper">
                                <svg class="btn-icon-svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="12" y1="5" x2="12" y2="19"></line>
                                    <line x1="5" y1="12" x2="19" y2="12"></line>
                                </svg>
                            </span>
                            <span class="btn-text">Neuer Umsatz</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Stats Cards -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-content">
                        <div class="stat-icon revenue-icon">
                            <span class="icon">💰</span>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value">€18,750</div>
                            <div class="stat-label">Gesamtumsatz</div>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-content">
                        <div class="stat-icon growth-icon">
                            <span class="icon">📈</span>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value">+8.3%</div>
                            <div class="stat-label">Wachstum</div>
                        </div>
                    </div>
                </div>
                
                <div class="stat-card">
                    <div class="stat-content">
                        <div class="stat-icon transactions-icon">
                            <span class="icon">🔄</span>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value">89</div>
                            <div class="stat-label">Behandlungen</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Content Grid -->
            <div class="content-grid">
                <!-- Recent Transactions -->
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Letzte Behandlungen</h2>
                        <button class="btn btn-secondary">Alle anzeigen</button>
                    </div>
                    
                    <div class="transactions-table">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Datum</th>
                                    <th>Patient & Behandlung</th>
                                    <th>Betrag</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>15.12.2024</td>
                                    <td>Max (Hund) - Impfung & Untersuchung</td>
                                    <td class="amount positive">€85.00</td>
                                    <td><span class="status-badge success">Abgeschlossen</span></td>
                                </tr>
                                <tr>
                                    <td>14.12.2024</td>
                                    <td>Luna (Katze) - Kastration</td>
                                    <td class="amount positive">€320.00</td>
                                    <td><span class="status-badge success">Abgeschlossen</span></td>
                                </tr>
                                <tr>
                                    <td>13.12.2024</td>
                                    <td>Rocky (Hund) - Zahnreinigung</td>
                                    <td class="amount positive">€180.00</td>
                                    <td><span class="status-badge pending">In Bearbeitung</span></td>
                                </tr>
                                <tr>
                                    <td>12.12.2024</td>
                                    <td>Bella (Katze) - Notfall OP</td>
                                    <td class="amount positive">€450.00</td>
                                    <td><span class="status-badge success">Abgeschlossen</span></td>
                                </tr>
                                <tr>
                                    <td>11.12.2024</td>
                                    <td>Charlie (Hund) - Routineuntersuchung</td>
                                    <td class="amount positive">€65.00</td>
                                    <td><span class="status-badge success">Abgeschlossen</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Revenue Chart -->
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Umsatzentwicklung</h2>
                        <div class="chart-controls">
                            <button class="btn btn-sm btn-secondary active">7 Tage</button>
                            <button class="btn btn-sm btn-secondary">30 Tage</button>
                            <button class="btn btn-sm btn-secondary">90 Tage</button>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-placeholder">
                            <div class="chart-icon">📊</div>
                            <p>Umsatzentwicklung Chart</p>
                            <small>Chart wird hier angezeigt</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- New Revenue Modal -->
    <div id="newRevenueModal" class="modal">
        <div class="modal-overlay"></div>
        <div class="modal-container">
            <div class="modal-header">
                <h2 class="modal-title">Neuer Umsatz</h2>
                <button class="modal-close" id="closeModal">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            <div class="modal-body">
                <form id="newRevenueForm">
                    <!-- Customer Information -->
                    <div class="form-section">
                        <h3 class="form-section-title">Kundeninformationen</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="customerName">Kundenname *</label>
                                <input type="text" id="customerName" name="customerName" required>
                            </div>
                            <div class="form-group">
                                <label for="customerEmail">E-Mail</label>
                                <input type="email" id="customerEmail" name="customerEmail">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="patientName">Patientenname *</label>
                                <input type="text" id="patientName" name="patientName" required>
                            </div>
                            <div class="form-group">
                                <label for="patientType">Tierart</label>
                                <select id="patientType" name="patientType">
                                    <option value="hund">Hund</option>
                                    <option value="katze">Katze</option>
                                    <option value="pferd">Pferd</option>
                                    <option value="kleintier">Kleintier</option>
                                    <option value="vogel">Vogel</option>
                                    <option value="sonstiges">Sonstiges</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Diagnosis Information -->
                    <div class="form-section">
                        <h3 class="form-section-title">Diagnose & Anamnese</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="diagnosis">Hauptdiagnose *</label>
                                <select id="diagnosis" name="diagnosis" required>
                                    <option value="">Bitte wählen...</option>
                                    <optgroup label="Häufige Diagnosen">
                                        <option value="routine_checkup">Routineuntersuchung - Gesund</option>
                                        <option value="vaccination">Impfung - Prophylaxe</option>
                                        <option value="parasite_infestation">Parasitenbefall</option>
                                        <option value="dental_disease">Zahnerkrankung</option>
                                        <option value="skin_condition">Hauterkrankung</option>
                                        <option value="gastrointestinal">Magen-Darm-Erkrankung</option>
                                        <option value="respiratory">Atemwegserkrankung</option>
                                        <option value="orthopedic">Orthopädische Erkrankung</option>
                                        <option value="neurological">Neurologische Erkrankung</option>
                                        <option value="cardiac">Herzerkrankung</option>
                                        <option value="renal">Nierenerkrankung</option>
                                        <option value="hepatic">Lebererkrankung</option>
                                        <option value="endocrine">Endokrine Erkrankung</option>
                                        <option value="cancer">Tumorerkrankung</option>
                                        <option value="trauma">Verletzung/Unfall</option>
                                        <option value="infection">Infektionskrankheit</option>
                                        <option value="allergy">Allergie</option>
                                        <option value="behavioral">Verhaltensproblem</option>
                                        <option value="reproductive">Fortpflanzungsproblem</option>
                                        <option value="emergency">Notfall</option>
                                    </optgroup>
                                    <optgroup label="Spezielle Diagnosen">
                                        <option value="custom">Benutzerdefinierte Diagnose</option>
                                    </optgroup>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="diagnosisSeverity">Schweregrad</label>
                                <select id="diagnosisSeverity" name="diagnosisSeverity">
                                    <option value="mild">Leicht</option>
                                    <option value="moderate" selected>Mittel</option>
                                    <option value="severe">Schwer</option>
                                    <option value="critical">Kritisch</option>
                                    <option value="preventive">Präventiv</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="symptoms">Symptome</label>
                                <textarea id="symptoms" name="symptoms" rows="3" placeholder="Beschreiben Sie die beobachteten Symptome..."></textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="anamnesis">Anamnese</label>
                                <textarea id="anamnesis" name="anamnesis" rows="3" placeholder="Vorgeschichte, Vorerkrankungen, Medikamente..."></textarea>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="treatmentPlan">Behandlungsplan</label>
                                <textarea id="treatmentPlan" name="treatmentPlan" rows="3" placeholder="Geplante Behandlung, Medikamente, Nachsorge..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Products/Services -->
                    <div class="form-section">
                        <h3 class="form-section-title">Leistungen & Produkte</h3>
                        <div id="itemsContainer">
                            <div class="item-row" data-item-id="1">
                                <div class="form-row">
                                    <div class="form-group flex-2">
                                        <label>Leistung/Produkt *</label>
                                        <select class="item-select" name="items[1][type]" required>
                                            <option value="">Bitte wählen...</option>
                                            <optgroup label="Behandlungen">
                                                <option value="routineuntersuchung" data-price="65.00">Routineuntersuchung - €65.00</option>
                                                <option value="impfung" data-price="45.00">Impfung - €45.00</option>
                                                <option value="kastration" data-price="320.00">Kastration - €320.00</option>
                                                <option value="zahnreinigung" data-price="180.00">Zahnreinigung - €180.00</option>
                                                <option value="operation" data-price="450.00">Operation - €450.00</option>
                                                <option value="notfall" data-price="200.00">Notfallbehandlung - €200.00</option>
                                            </optgroup>
                                            <optgroup label="Medikamente">
                                                <option value="antibiotika" data-price="35.00">Antibiotika - €35.00</option>
                                                <option value="schmerzmittel" data-price="25.00">Schmerzmittel - €25.00</option>
                                                <option value="vitamine" data-price="15.00">Vitamine - €15.00</option>
                                            </optgroup>
                                            <optgroup label="Zubehör">
                                                <option value="halsband" data-price="20.00">Halsband - €20.00</option>
                                                <option value="futter" data-price="30.00">Spezialfutter - €30.00</option>
                                                <option value="spielzeug" data-price="12.00">Spielzeug - €12.00</option>
                                            </optgroup>
                                        </select>
                                    </div>
                                    <div class="form-group flex-1">
                                        <label>Menge</label>
                                        <input type="number" class="item-quantity" name="items[1][quantity]" value="1" min="1" max="99">
                                    </div>
                                    <div class="form-group flex-1">
                                        <label>Preis (€)</label>
                                        <input type="number" class="item-price" name="items[1][price]" step="0.01" min="0" readonly>
                                    </div>
                                    <div class="form-group flex-1">
                                        <label>Gesamt (€)</label>
                                        <input type="number" class="item-total" name="items[1][total]" step="0.01" min="0" readonly>
                                    </div>
                                    <div class="form-group flex-0">
                                        <label>&nbsp;</label>
                                        <button type="button" class="btn btn-danger btn-remove-item" style="display: none;">
                                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                                <line x1="6" y1="6" x2="18" y2="18"></line>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button type="button" class="btn btn-secondary btn-add-item" id="addItemBtn">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <line x1="12" y1="5" x2="12" y2="19"></line>
                                <line x1="5" y1="12" x2="19" y2="12"></line>
                            </svg>
                            Weitere Leistung hinzufügen
                        </button>
                    </div>

                    <!-- Summary -->
                    <div class="form-section">
                        <h3 class="form-section-title">Zusammenfassung</h3>
                        <div class="summary-grid">
                            <div class="summary-item">
                                <span class="summary-label">Zwischensumme:</span>
                                <span class="summary-value" id="subtotal">€0.00</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">MwSt. (19%):</span>
                                <span class="summary-value" id="tax">€0.00</span>
                            </div>
                            <div class="summary-item summary-total">
                                <span class="summary-label">Gesamtbetrag:</span>
                                <span class="summary-value" id="total">€0.00</span>
                            </div>
                        </div>
                    </div>

                    <!-- Notes -->
                    <div class="form-section">
                        <h3 class="form-section-title">Notizen</h3>
                        <div class="form-group">
                            <label for="notes">Anmerkungen</label>
                            <textarea id="notes" name="notes" rows="3" placeholder="Zusätzliche Informationen zur Behandlung..."></textarea>
                        </div>
                    </div>
                </form>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="cancelBtn">Abbrechen</button>
                <button type="button" class="btn btn-primary" id="createInvoiceBtn">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14,2 14,8 20,8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10,9 9,9 8,9"></polyline>
                    </svg>
                    Rechnung erstellen
                </button>
            </div>
        </div>
    </div>
    
    <!-- JavaScript Files -->
    <script src="../../components/navbar/navbar.js"></script>
    <script src="../../components/sidebar/sidebar.js"></script>
    <script src="../../index.js"></script>
    
    <!-- Load Authentication System -->
    <script src="../../../login/config.js"></script>
    <script type="module" src="../../../login/auth.js"></script>
    
    <!-- Initialize Authentication for Main App -->
    <script type="module">
        // Wait for auth manager to be available
        document.addEventListener('DOMContentLoaded', async () => {
            while (!window.authManager) {
                await new Promise(resolve => setTimeout(resolve, 100))
            }

            // Check if user is authenticated
            const isAuthenticated = await window.authManager.requireAuth()
            
            if (!isAuthenticated) {
                // User will be redirected to login by requireAuth()
                return
            }

            // User is authenticated, continue with app initialization
            console.log('User authenticated, umsatz page ready');
        });
    </script>
    
    <script src="umsatz.js"></script>
</body>
</html>
